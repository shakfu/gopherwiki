{{define "generic_content"}}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
        <li class="breadcrumb-item"><a href="/-/issues">Issues</a></li>
        <li class="breadcrumb-item active">#{{.issue.ID}}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-start mb-3">
    <div>
        <h1 class="mb-1">
            {{if eq .issue.Status "open"}}
            <span class="issue-status-open" title="Open"><i class="fas fa-exclamation-circle"></i></span>
            {{else}}
            <span class="issue-status-closed" title="Closed"><i class="fas fa-check-circle"></i></span>
            {{end}}
            {{.issue.Title}}
        </h1>
        <p class="text-muted">
            <span class="badge {{if eq .issue.Status "open"}}badge-success{{else}}badge-secondary{{end}}">{{.issue.Status}}</span>
            #{{.issue.ID}} opened {{formatDatetime .issue.CreatedAt.Time "relative"}}
            {{if .issue.CreatedByName.Valid}}by {{.issue.CreatedByName.String}}{{end}}
        </p>
    </div>
    <div>
        {{if .canEdit}}
        <a href="/-/issues/{{.issue.ID}}/edit" class="btn btn-sm btn-outline-primary">Edit</a>
        {{if eq .issue.Status "open"}}
        <form action="/-/issues/{{.issue.ID}}/close" method="post" class="d-inline">
            <button type="submit" class="btn btn-sm btn-outline-secondary">Close Issue</button>
        </form>
        {{else}}
        <form action="/-/issues/{{.issue.ID}}/reopen" method="post" class="d-inline">
            <button type="submit" class="btn btn-sm btn-outline-success">Reopen Issue</button>
        </form>
        {{end}}
        {{end}}
        {{if .canDelete}}
        <form action="/-/issues/{{.issue.ID}}/delete" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this issue?');">
            <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
        </form>
        {{end}}
    </div>
</div>

{{if or .issue.Category.Valid .tags}}
<div class="mb-3">
    {{if .issue.Category.Valid}}
    <span class="badge badge-info mr-2">{{.issue.Category.String}}</span>
    {{end}}
    {{range .tags}}
    <span class="badge issue-tag issue-tag-{{.}}">{{.}}</span>
    {{end}}
</div>
{{end}}

<div class="issue-description card">
    <div class="card-body">
        {{if .htmlcontent}}
        <div class="wiki-content">
            {{.htmlcontent}}
        </div>
        {{else}}
        <p class="text-muted">No description provided.</p>
        {{end}}
    </div>
</div>

{{if .comments}}
<h3 class="mt-4 mb-3">Comments ({{.comment_count}})</h3>
{{range .comments}}
<div class="card mb-3" id="comment-{{.Comment.ID}}">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <small class="text-muted">
                {{if .Comment.AuthorName.Valid}}{{.Comment.AuthorName.String}}{{else}}Anonymous{{end}}
                commented {{formatDatetime .Comment.CreatedAt.Time "relative"}}
            </small>
            {{if $.canDelete}}
            <form action="/-/issues/{{$.issue.ID}}/comment/{{.Comment.ID}}/delete" method="post" class="d-inline" onsubmit="return confirm('Delete this comment?');">
                <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete comment"><i class="fas fa-trash-alt"></i></button>
            </form>
            {{end}}
        </div>
        <div class="wiki-content">
            {{.HTMLContent}}
        </div>
    </div>
</div>
{{end}}
{{else}}
<h3 class="mt-4 mb-3">Comments (0)</h3>
<p class="text-muted">No comments yet.</p>
{{end}}

{{if (index $.current_user "is_authenticated")}}
<div class="card mt-3 mb-3">
    <div class="card-body">
        <form action="/-/issues/{{.issue.ID}}/comment" method="post">
            <div class="form-group">
                <label for="comment-content">Add a comment</label>
                <textarea class="form-control" id="comment-content" name="content" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Comment</button>
        </form>
    </div>
</div>
{{end}}

<div class="mt-3">
    <a href="/-/issues" class="btn btn-outline-secondary">Back to Issues</a>
</div>
{{end}}
